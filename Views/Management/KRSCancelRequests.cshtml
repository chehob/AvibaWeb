@using AvibaWeb.ViewModels.CollectionViewModels
@using X.PagedList
@using X.PagedList.Mvc.Core
@using X.PagedList.Mvc.Common
@using AvibaWeb.ViewModels.ManagementViewModels
@using AvibaWeb.DomainModels
@model IPagedList<KRSCancelRequestViewModel>

<div class="row">
    <!-- CONTENT START -->
    <div class="box col-md-12">
        <div class="box-inner">
            <div class="box-header well" data-original-title="">
                <h2>Запросы на аннуляцию КРС</h2>
            </div>
            <div class="box-content">
                @if (!Model.Any())
                {
                    <tr><td colspan="4" class="text-center">Нет запросов</td></tr>
                }
                else
                {
                    foreach (var krs in Model)
                    {
                    <div class="row">
                        <div class="col-md-1">
                            @switch (krs.Status)
                            {
                                case KRSCancelRequestOperation.KCROType.New:
                                    // новый
                                     <span class="label-success label label-info">@Html.DisplayFor(k => krs.Status)</span><br>
                                    break;

                                case KRSCancelRequestOperation.KCROType.Accepted:
                                    // принят
                                    <span class="label-success label label-default">@Html.DisplayFor(k => krs.Status)</span><br>
                                    break;

                                case KRSCancelRequestOperation.KCROType.Rejected:
                                    // отказ
                                     <span class="label-success label label-danger">@Html.DisplayFor(k => krs.Status)</span><br>
                                    break;
                            }
                            
                            @krs.DealDateTime</div>
                        <div class="col-md-3">
                            <b>@krs.CashierName</b><br>
                            @krs.Desk<br>
                            
                        </div>
                            <div class="col-md-3">
                            <b>КРС №: @krs.KRSNumber</b><br>
                            <b>Стоимость КРС: @krs.KRSAmount</b><br>
                            <i>@krs.Description</i>
                            </div>
                        <div class="col-md-3">
                            @krs.BSONumber <br>
                            <b>@krs.PassengerName</b><br>
                            @krs.Route<br>
                            Стоимость билета: @krs.Payment
                            </div>

                        
                    </div>
                    <div class="row">
                        <div class="col-md-5">
                            
                           @if (krs.Status != KRSCancelRequestOperation.KCROType.New)
                            {
                                @switch (krs.Status)
                            {
                                case KRSCancelRequestOperation.KCROType.New:
                                    // новый
                                     
                                    break;

                                case KRSCancelRequestOperation.KCROType.Accepted:
                                    // принят
                                <span style="background-color:rgb(198, 233, 164)">
                                &nbsp;Заявку принял(а): 
                                @krs.ManagerName&nbsp;
                                </span>    
                                    break;

                                case KRSCancelRequestOperation.KCROType.Rejected:
                                    // отказ
                                     <span style="background-color:#c71c22; color:white">
                                &nbsp;Заявку отменил(а): 
                                @krs.ManagerName&nbsp;
                                </span>  
                                    break;
                            }
                               
                            } 

                            
                             

                        </div>
                    </div>
                        <div class="row">
                          <div class="col-md-5">
                            @if (krs.Status == KRSCancelRequestOperation.KCROType.New)
                                    {
                                <form style="display: inline-block;" asp-controller="Management" asp-action="AcceptKRSCancellation" asp-route-id="@krs.RequestId"
                                      data-ajax-update="#results" data-ajax="true" data-ajax-method="POST">
                                    <input id="btnAcceptCollection" type="submit" name="picture" class="btn btn-success btn-sm" value="Принять" />
                                </form>

                                <form style="display: inline-block;" asp-controller="Management" asp-action="RejectKRSCancellation" asp-route-id="@krs.RequestId"
                                      data-ajax-update="#results" data-ajax="true" data-ajax-method="POST">
                                    <input id="btnRejectCollection" type="submit" name="picture" class="btn btn-danger btn-sm" value="Отклонить" />
                                </form>
                            }
                        </div>  
                        </div>
                        
                    
                        <hr>
                    }
                }




                @Html.PagedListPager(Model, page => Url.Action("KRSCancelRequests", new { page }),
                    new Func<PagedListRenderOptionsBase>(() =>
                    {
                        var options = PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(
                            new AjaxOptions()
                            {
                                HttpMethod = "GET",
                                UpdateTargetId = "results"
                            });
                            options.MaximumPageNumbersToDisplay = 5;
                        return options;
                    })())
            </div>
        </div>
    </div>
</div>
